@page
@model EstagiarioProfileModel
@using EstagioGO.Data
@using EstagioGO.Constants
@inject UserManager<ApplicationUser> UserManager
@{
    ViewData["Title"] = "Meu Perfil de Estagiário";
    ViewData["ActivePage"] = ManageNavPages.EstagiarioProfile;
}

<partial name="_StatusMessage" model="Model.StatusMessage" />

@if (Model.Estagiario != null)
{
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light d-flex align-items-center">
                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 60px; height: 60px;">
                        <span class="text-white fw-bold fs-4">@Model.Estagiario.Nome.FirstOrDefault()</span>
                    </div>
                    <div>
                        <h4 class="mb-0">@Model.Estagiario.Nome</h4>
                        <p class="text-muted mb-0">@Model.Estagiario.Curso</p>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title mb-3 border-bottom pb-2">
                        <i class="fas fa-file-contract me-2"></i>Detalhes do Contrato
                    </h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="fas fa-user-tie me-2 text-muted"></i><strong>Supervisor</strong></div>
                            <span class="text-end">@(Model.Estagiario.Supervisor?.NomeCompleto ?? "Não definido")</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="fas fa-building me-2 text-muted"></i><strong>Instituição</strong></div>
                            <span class="text-end">@Model.Estagiario.InstituicaoEnsino</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="fas fa-calendar-alt me-2 text-muted"></i><strong>Início do Estágio</strong></div>
                            <span class="badge bg-success">@Model.Estagiario.DataInicio.ToShortDateString()</span>
                        </li>
                        @if (Model.Estagiario.DataTermino.HasValue)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div><i class="fas fa-calendar-times me-2 text-muted"></i><strong>Término do Estágio</strong></div>
                                <span class="badge bg-danger">@Model.Estagiario.DataTermino.Value.ToShortDateString()</span>
                            </li>
                        }
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="fas fa-toggle-on me-2 text-muted"></i><strong>Status</strong></div>
                            <span class="badge bg-@(Model.Estagiario.Ativo ? "primary" : "secondary")">@(Model.Estagiario.Ativo ? "Ativo" : "Inativo")</span>
                        </li>
                    </ul>

                    <h5 class="card-title mt-4 mb-3 border-bottom pb-2">
                        <i class="fas fa-address-card me-2"></i>Informações Pessoais
                    </h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="fas fa-id-card me-2 text-muted"></i><strong>CPF</strong></div>
                            <span>@Model.Estagiario.CPFFormatado</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="fas fa-phone me-2 text-muted"></i><strong>Telefone</strong></div>
                            <span>@Model.Estagiario.TelefoneFormatado</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="fas fa-hashtag me-2 text-muted"></i><strong>Matrícula</strong></div>
                            <span>@Model.Estagiario.Matricula</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Resumo de Desempenho</h5>
                </div>
                <div class="card-body">
                    <div class="card text-center mb-3">
                        <div class="card-body">
                            <h2 class="card-title fw-bold text-primary">@Model.Estagiario.Frequencias.Count</h2>
                            <p class="card-text text-muted">Frequências Registradas</p>
                        </div>
                    </div>
                    <div class="card text-center">
                        <div class="card-body">
                            <h2 class="card-title fw-bold text-primary">@Model.Estagiario.Avaliacoes.Count</h2>
                            <p class="card-text text-muted">Avaliações Recebidas</p>
                        </div>
                    </div>
                    <div class="text-center text-muted mt-3">
                        <small>Cadastro realizado em @Model.Estagiario.DataCadastro.ToShortDateString()</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    // A mensagem de erro agora é controlada pelo StatusMessage no PageModel
}